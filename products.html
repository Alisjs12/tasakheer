<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ³Ø§Ø®ÙŠØ± | TASAKHEER</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Cinzel:wght@700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <style>
        :root { --gold: #c5a059; --bg: #0b0b0b; --card-bg: #161616; --nav-bg: #000000; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); color: #fff; font-family: 'Cairo', sans-serif; 
            margin: 0; padding-bottom: 90px; overflow-x: hidden;
        }

        header { 
            background: var(--nav-bg); padding: 15px; text-align: center; 
            border-bottom: 1px solid #222; position: sticky; top: 0; z-index: 1000;
        }
        .logo { font-family: 'Cinzel'; color: var(--gold); font-size: 1.3rem; letter-spacing: 4px; }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .page-section { display: none; animation: fadeIn 0.3s ease; }
        .active-section { display: block; }

        /* Ø§Ù„Ø¨Ø­Ø« */
        .search-container {
            padding: 12px 15px; background: var(--nav-bg);
            display: flex; gap: 8px; align-items: center;
            position: sticky; top: 58px; z-index: 999;
        }
        .search-bar {
            flex: 1; background: #1a1a1a; border-radius: 12px;
            display: flex; align-items: center; padding: 0 12px; border: 1px solid #333;
        }
        .search-bar input {
            background: none; border: none; color: white; padding: 12px 5px;
            width: 100%; outline: none; font-family: 'Cairo'; font-size: 0.95rem;
        }

        .icon-btn {
            background: var(--gold); border: none; width: 42px; height: 42px;
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; cursor: pointer;
        }
        .icon-btn svg { width: 20px; height: 20px; fill: #000; }

        /* Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 12px; }
        .card { background: var(--card-bg); border-radius: 15px; border: 1px solid #222; overflow: hidden; }
        .card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .card-body { padding: 12px; text-align: center; }
        .card-title { font-size: 0.85rem; font-weight: 600; color: #ddd; height: 40px; overflow: hidden; }
        .price { color: var(--gold); font-weight: 700; margin: 8px 0; }
        
        .add-btn {
            background: var(--gold); color: #000; border: none; padding: 10px;
            border-radius: 8px; font-weight: bold; width: 100%; font-size: 0.8rem;
        }

        /* Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ */
        .container { padding: 20px; text-align: center; }
        .cart-item { background: #1a1a1a; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .checkout-btn { background: #25d366; color: white; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; margin-top: 20px; }
        .offer-card { background: linear-gradient(45deg, #c5a059, #8c6d33); color: #000; padding: 25px; border-radius: 15px; margin-top: 15px; }

        /* Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(0,0,0,0.95); backdrop-filter: blur(10px);
            height: 70px; display: flex; justify-content: space-around; 
            border-top: 1px solid #222; z-index: 1001;
        }
        .nav-item {
            color: #777; display: flex; flex-direction: column; align-items: center;
            justify-content: center; font-size: 0.7rem; width: 33%; cursor: pointer;
        }
        .nav-item svg { width: 22px; height: 22px; fill: #777; margin-bottom: 4px; }
        .nav-item.active { color: var(--gold); }
        .nav-item.active svg { fill: var(--gold); }

        /* ÙƒØ§Ù…ÙŠØ±Ø§ */
        #camera-ui { display: none; position: fixed; inset: 0; background: #000; z-index: 2000; }
        #video { width: 100%; height: 100%; object-fit: cover; }
        .cam-close { position: absolute; top: 30px; left: 20px; background: var(--gold); padding: 10px; border-radius: 8px; z-index: 2001; color:#000; font-weight:bold;}

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .listening { background: #ff4d4d !important; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,77,77,0.7); } 70% { box-shadow: 0 0 0 10px rgba(255,77,77,0); } 100% { box-shadow: 0 0 0 0 rgba(255,77,77,0); } }
    </style>
</head>
<body>

<header><div class="logo">TASAKHEER</div></header>

<div id="page-products" class="page-section active-section">
    <div class="search-container">
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ ØªØ³Ø§Ø®ÙŠØ±...">
        </div>
        <button id="voiceBtn" class="icon-btn">
            <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
        </button>
        <button id="cameraBtn" class="icon-btn">
            <svg viewBox="0 0 24 24"><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>
        </button>
    </div>
    <div id="grid" class="grid">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
</div>

<div id="page-offers" class="page-section">
    <div class="container">
        <h2 style="color:var(--gold)">Ø¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ©</h2>
        <div class="offer-card">
            <h3>Ø®ØµÙ… 20% ğŸ‰</h3>
            <p>Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø·Ù„Ø¨ Ù„Ùƒ Ø§Ù„ÙŠÙˆÙ… Ù…Ù† ØªØ³Ø§Ø®ÙŠØ±</p>
        </div>
        <div id="offersGrid" class="grid"></div>
    </div>
</div>

<div id="page-cart" class="page-section">
    <div class="container">
        <h2 style="color:var(--gold)">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
        <div id="cartItems">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>
        <div id="cartTotal" style="margin-top:20px; font-weight:bold; font-size:1.2rem"></div>
        <button id="checkoutBtn" class="checkout-btn" style="display:none">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ (ÙˆØ§ØªØ³Ø§Ø¨)</button>
    </div>
</div>

<div id="camera-ui">
    <div class="cam-close" onclick="stopCamera()">Ø¥ØºÙ„Ø§Ù‚</div>
    <video id="video" autoplay playsinline></video>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="showSection('page-products', this)">
        <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    </div>
    <div class="nav-item" onclick="showSection('page-offers', this)">
        <svg viewBox="0 0 24 24"><path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42z"/></svg>Ø§Ù„Ø¹Ø±ÙˆØ¶
    </div>
    <div class="nav-item" onclick="showSection('page-cart', this)">
        <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1z"/></svg>Ø§Ù„Ø³Ù„Ø©
    </div>
</div>

<script>
    let allProducts = [];
    let cart = [];

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    function showSection(id, el) {
        document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active-section'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active-section');
        el.classList.add('active');
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    fetch('https://tasakheer-88c09-default-rtdb.firebaseio.com/products.json')
    .then(res => res.json())
    .then(data => {
        allProducts = Object.values(data || {});
        render(allProducts);
    });

    function render(list) {
        document.getElementById('grid').innerHTML = list.map((p, i) => `
            <div class="card">
                <img src="${p.img}" loading="lazy">
                <div class="card-body">
                    <div class="card-title">${p.name}</div>
                    <div class="price">${p.price} Ø¯.Ù„</div>
                    <button class="add-btn" onclick="addToCart(${i})">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
                </div>
            </div>
        `).join('');
    }

    function addToCart(index) {
        cart.push(allProducts[index]);
        updateCart();
        alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­");
    }

    function updateCart() {
        const itemsDiv = document.getElementById('cartItems');
        const totalDiv = document.getElementById('cartTotal');
        const btn = document.getElementById('checkoutBtn');

        if(cart.length === 0) {
            itemsDiv.innerHTML = "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©";
            btn.style.display = 'none';
            return;
        }

        itemsDiv.innerHTML = cart.map((item, i) => `
            <div class="cart-item">
                <span>${item.name}</span>
                <b>${item.price} Ø¯.Ù„</b>
            </div>
        `).join('');

        const total = cart.reduce((s, item) => s + parseInt(item.price), 0);
        totalDiv.innerHTML = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¯.Ù„`;
        btn.style.display = 'block';
    }

    document.getElementById('checkoutBtn').onclick = () => {
        let msg = "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ØªØ³Ø§Ø®ÙŠØ±:\n";
        cart.forEach(i => msg += `- ${i.name} (${i.price} Ø¯.Ù„)\n`);
        window.open(`https://wa.me/218910000000?text=${encodeURIComponent(msg)}`);
    };

    // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ
    const voiceBtn = document.getElementById('voiceBtn');
    if ('webkitSpeechRecognition' in window) {
        const rec = new webkitSpeechRecognition();
        rec.lang = 'ar-SA';
        voiceBtn.onclick = () => { rec.start(); voiceBtn.classList.add('listening'); };
        rec.onresult = (e) => {
            const txt = e.results[0][0].transcript;
            document.getElementById('searchInput').value = txt;
            render(allProducts.filter(p => p.name.includes(txt)));
            voiceBtn.classList.remove('listening');
        };
    }

    // Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    const codeReader = new ZXing.BrowserMultiFormatReader();
    document.getElementById('cameraBtn').onclick = () => {
        document.getElementById('camera-ui').style.display = 'block';
        codeReader.decodeFromVideoDevice(null, 'video', (res) => {
            if(res) {
                document.getElementById('searchInput').value = res.text;
                render(allProducts.filter(p => p.name.includes(res.text)));
                stopCamera();
            }
        });
    };

    function stopCamera() {
        codeReader.reset();
        document.getElementById('camera-ui').style.display = 'none';
    }
</script>

</body>
</html>